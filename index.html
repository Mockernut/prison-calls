<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>D3: A true bar chart with SVG rects</title>
    <script type="text/javascript" src="http://palm.desertsun.com/JavaScript/d3/d3.min.js"></script>
    <script src="http://www.d3plus.org/js/d3plus.js"></script>
    <style type="text/css">
img#background {
        position: absolute;
        left: 260px;
        top: 41px;
        height: 200px;
        opacity: 0.1;
    }
    
    img#legend {
        position: absolute;
        left: 20px;
        top: 245px;
    }
    
    button {
        position: absolute;
        left: 116px;
        top: 200px;
        width: 100px;
    }
    
    .chatter {
        font-family: sans-serif;
        font-size: 14px;
        fill: black;
    }
    
    .chatterTxtRect {
        fill: white;
    }
    
    .txtValues {
        font-family: sans-serif;
        font-size: 12px;
        fill: black;
        text-anchor: middle;
    }
    
    .txtKey {
        font-family: sans-serif;
        font-size: 12px;
        fill: black;
    }
    
    #tds-jailcalls {
        width: 540;
        height: 235;
    }
}
    </style>
    <script>
    function interactiveChart() {
        //GLOBAL VARIABLES
        //GLOBAL VARIABLES
        //GLOBAL VARIABLES
        //GLOBAL VARIABLES

        //Width and height
        var w = 539;
        var h = 233;
        var tw = 333;
        var th = 150;
        var barPadding = 4;
        var leftEdge = 143;

        //Verticle scale of the bar chart
        var yScale = d3.scale.linear()
            .domain(
                [0, 30]
            )
            .rangeRound(
                [0, h]
            );




        var key = function(d) {
            return d.key;
        };

        var slideOneTxt = "A woman, Sarah, who lives in the Riverside County, wants to stay in contact with her brother, John, who is held in a local jail. Sarah opens a Securus account so John can call her, then makes a $25 deposit into her account through the company website.";
        var slideTwoTxt = "Securus adds a $7.95 deposit fee to Sarah’s account, charging her for the “convenience” of using her credit card. Because Sarah wants John to be able to call her cell phone, instead of just a landline, so a monthly “wireless administration fee” of $3.99 is subtracted from her account.";
        var slideThreeTxt = "Over the next two weeks, Sarah gets three calls from John. Each time, they talk for 15 minutes. Sarah is charged about 14 cents per minute, for a total of $6.12. Securus also tracks Sarah’s location, then offsets the cost by adding a 4% “location validation fee” to each of her calls.";
        var slideFourTxt = "One day, Sarah drives to Arizona to visit her mother. John calls her house, while she is gone, then leaves a voicemail. Securus charges a voicemail fee of $1.95.";
        var slideFiveTxt = "John then calls Sarah on her cell phone, and they speak for 15 minutes. The call costs 20 cents per minute, for a total of $3, plus the 4% location fee and a 5% “state cost recovery fee” that is applied to interstate calls. Sarah is also charged an additional $3.49 fee because she accepted an out-of-state call.";
        var slideSixTxt = "End result: Since Sarah signed up to Securus, she has spoken to her brother four times, for a total of one hour. Those calls have cost her about $9, but she has spent nearly twice that much money on fees. After two or three more calls, Sarah will need to add more money to her account, restarting this process.";
        var buttonText = document.getElementById("button");

        //DATA VARIABLES
        var dataset = [{
            key: 0,
            value: 25
        }, {
            key: 1,
            value: 0
        }, {
            key: 2,
            value: 0
        }];


        var data = [1];

        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS
        //START OF FUNCTIONS

        //SLIDE 2
        //SLIDE 2
        //SLIDE 2
        //SLIDE 2
        //SLIDE 2
        //SLIDE 2
        //SLIDE 2
        //SLIDE 2

        function slide2() {
            buttonText.innerHTML = "Next";
            //New values for dataset

            var dataset = [{
                key: 0,
                value: 21.01
            }, {
                key: 1,
                value: 0
            }, {
                key: 2,
                value: 11.94
            }];

            //Update svg
            svg.selectAll("rect")
                .data(dataset, key)
                .transition()
                .duration(1000)
                .attr("y", function(d) {
                    return h - yScale(d.value);
                })
                .attr("height", function(d) {
                    return yScale(d.value);
                })
                .attr("fill", function(d) {
                    if (d.value == 21.01) {
                        return "green";
                    }
                    if (d.value == 0) {
                        return "orange";
                    } else {
                        return "red";
                    }
                });
            svg.selectAll("text")
                .data(dataset)
                .transition()
                .duration(1000)
                .text(function(d) {
                    return "$" + d.value;
                })
                .attr("y", function(d) {
                    return h - yScale(d.value) - 4;
                });
            //Update chatter
            svg.selectAll("g")
                .append("rect")
                .attr("width", tw)
                .attr("height", th)
                .attr("class", "chatterTxtRect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                });
            g.append("text")
                .attr("x", "20")
                .attr("y", "20")
                .attr("class", "chatter")
                .text(function() {
                    return slideTwoTxt;
                })
                .each(function(d) {
                    d3plus.textwrap().container(d3.select(this)).draw();
                });
        }

        //SLIDE 3
        //SLIDE 3
        //SLIDE 3
        //SLIDE 3
        //SLIDE 3
        //SLIDE 3
        //SLIDE 3
        //SLIDE 3

        function slide3() {
            buttonText.innerHTML = "Next";
            //New values for dataset
            var dataset = [{
                key: 0,
                value: 14.65
            }, {
                key: 1,
                value: 6.12
            }, {
                key: 2,
                value: 12.18
            }];

            //Update all rects
            svg.selectAll("rect")
                .data(dataset, key)
                .transition()
                .duration(1000)
                .attr("y", function(d) {
                    return h - yScale(d.value);
                })
                .attr("height", function(d) {
                    return yScale(d.value);
                })
                .attr("fill", function(d) {
                    if (d.value == 14.65) {
                        return "green";
                    }
                    if (d.value == 6.12) {
                        return "orange";
                    } else {
                        return "red";
                    }
                });
            svg.selectAll("text")
                .data(dataset)
                .transition()
                .duration(1000)
                .text(function(d) {
                    return "$" + d.value;
                })
                .attr("y", function(d) {
                    return h - yScale(d.value) - 4;
                });
            //Update chatter
            svg.selectAll("g")
                .append("rect")
                .attr("width", tw)
                .attr("height", th)
                .attr("class", "chatterTxtRect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                });
            g.append("text")
                .attr("x", "20")
                .attr("y", "20")
                .text(function() {
                    return slideThreeTxt;
                })
                .attr("class", "chatter")
                .each(function(d) {
                    d3plus.textwrap().container(d3.select(this)).draw();
                });
        }

        //SLIDE 4
        //SLIDE 4
        //SLIDE 4
        //SLIDE 4
        //SLIDE 4
        //SLIDE 4
        //SLIDE 4
        //SLIDE 4

        function slide4() {
            buttonText.innerHTML = "Next";
            //New values for dataset

            var dataset = [{
                key: 0,
                value: 12.66
            }, {
                key: 1,
                value: 6.12
            }, {
                key: 2,
                value: 14.17
            }];
            //Update all rects
            svg.selectAll("rect")
                .data(dataset, key)
                .transition()
                .duration(1000)
                .attr("y", function(d) {
                    return h - yScale(d.value);
                })
                .attr("height", function(d) {
                    return yScale(d.value);
                })
                .attr("fill", function(d) {
                    if (d.value == 12.66) {
                        return "green";
                    }
                    if (d.value == 6.12) {
                        return "orange";
                    } else {
                        return "red";
                    }
                });
            svg.selectAll("text")
                .data(dataset)
                .transition()
                .duration(1000)
                .text(function(d) {
                    return "$" + d.value;
                })
                .attr("y", function(d) {
                    return h - yScale(d.value) - 4;
                });
            //Update chatter
            svg.selectAll("g")
                .append("rect")
                .attr("width", tw)
                .attr("height", th)
                .attr("class", "chatterTxtRect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                });
            g.append("text")
                .attr("x", "20")
                .attr("y", "20")
                .text(function() {
                    return slideFourTxt;
                })
                .attr("class", "chatter")
                .each(function(d) {
                    d3plus.textwrap().container(d3.select(this)).draw();
                });
        }


        //SLIDE 5
        //SLIDE 5
        //SLIDE 5
        //SLIDE 5
        //SLIDE 5
        //SLIDE 5
        //SLIDE 5
        //SLIDE 5


        function slide5() {
            buttonText.innerHTML = "Next";
            //New values for dataset


            var dataset = [{
                key: 0,
                value: 9.66
            }, {
                key: 1,
                value: 9.12
            }, {
                key: 2,
                value: 17.93
            }];
            //Update all rects
            svg.selectAll("rect")
                .data(dataset, key)
                .transition()
                .duration(1000)
                .attr("y", function(d) {
                    return h - yScale(d.value);
                })
                .attr("height", function(d) {
                    return yScale(d.value);
                })
                .attr("fill", function(d) {
                    if (d.value == 9.66) {
                        return "green";
                    }
                    if (d.value == 9.12) {
                        return "orange";
                    } else {
                        return "red";
                    }
                });
            svg.selectAll("text")
                .data(dataset, key)
                .transition()
                .duration(1000)
                .text(function(d) {
                    return "$" + d.value;
                })
                .attr("y", function(d) {
                    return h - yScale(d.value) - 4;
                });
            //Update chatter
            svg.selectAll("g")
                .append("rect")
                .attr("width", tw)
                .attr("height", th)
                .attr("class", "chatterTxtRect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                });
            g.append("text")
                .attr("x", "20")
                .attr("y", "20")
                .text(function() {
                    return slideFiveTxt;
                })
                .attr("class", "chatter")
                .each(function(d) {
                    d3plus.textwrap().container(d3.select(this)).draw();
                });
        }

        //SLIDE 6
        //SLIDE 6
        //SLIDE 6
        //SLIDE 6
        //SLIDE 6
        //SLIDE 6
        //SLIDE 6
        //SLIDE 6



        function slide6() {

            var dataset = [{
                key: 1,
                value: 9.12
            }, {
                key: 2,
                value: 17.93
            }];

            var bars = svg.selectAll("rect")
                .data(dataset, key);

            bars.transition()
                .duration(1000)
                .attr("x", function(d, i) {
                    return i * 60 + (w - leftEdge);
                })
                .attr("y", function(d) {
                    return h - yScale(d.value);
                })
                .attr("width", 60 - barPadding)
                .attr("height", function(d) {
                    return yScale(d.value);
                });
            bars.exit()
                .transition()
                .duration(250)
                .attr("x", w)
                .remove();


            var text = svg.selectAll("text")
                .data(dataset, key);

            text.transition()
                .duration(1000)



            .attr("x", function(d, i) {
                    return i * 60 + (w - leftEdge) + (60 - barPadding) / 2;
                })
                .attr("y", function(d) {
                    return h - yScale(d.value) - 4;
                })



            .attr("width", 60 - barPadding)
                .attr("height", function(d) {
                    return yScale(d.value);
                });
            text.exit()
                .transition()
                .duration(0)
                .attr("x", w)
                .remove();







            //Update chatter
            svg.selectAll("g")
                .append("rect")
                .attr("width", tw)
                .attr("height", th)
                .attr("class", "chatterTxtRect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                });
            g.append("text")
                .attr("x", "20")
                .attr("y", "20")
                .text(function() {
                    return slideSixTxt;
                })
                .attr("class", "chatter")
                .each(function(d) {
                    d3plus.textwrap().container(d3.select(this)).draw();
                });





            buttonText.innerHTML = "Replay";


        }



        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS
        //END OF FUNCTIONS




        //Create SVG element
        buttonText.innerHTML = "Next";

        var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

        svg.selectAll("rect")
            .data(dataset, key)
            .enter()
            .append("rect")

        .attr("x", function(d, i) {
            return i * 40 + (w - leftEdge);
        })


        .attr("y", function(d) {
                return h - yScale(d.value);
            })
            .attr("width", 40 - barPadding)

        .attr("height", function(d) {
                return yScale(d.value);
            })
            .attr("fill", function(d) {
                if (d.value == 25) {
                    return "green";
                } else {
                    return "white";
                }
            });
        svg.selectAll("text")
            .data(dataset, key)
            .enter()
            .append("text")
            .attr("class", "txtValues")
            .text(function(d) {
                return "$" + d.value;
            })
            .attr("x", function(d, i) {
                return i * 40 + (w - leftEdge) + (40 - barPadding) / 2;
            })
            .attr("y", function(d) {
                return h - yScale(d.value) - 4;
            });



        var g = svg.selectAll("g")
            .data(data)
            .enter()
            .append("g");
        g.append("rect")
            .attr("width", tw)
            .attr("height", th)
            .attr("class", "chatterTxtRect")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return d.y;
            });
        g.append("text")
            .attr("x", "20")
            .attr("y", "20")
            .text(function() {
                return slideOneTxt;
            })
            .attr("class", "chatter")
            .each(function(d) {
                d3plus.textwrap().container(d3.select(this)).draw();
            });


        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES
        //EVENT HANDLER TO MOVE THROUGH SLIDES


        d3.select("#button")
            .on("click", function() {
                slide2();
                d3.select("#button")
                    .on("click", function() {
                        slide3();
                        d3.select("#button")
                            .on("click", function() {
                                slide4();
                                d3.select("#button")
                                    .on("click", function() {
                                        slide5();
                                        d3.select("#button")
                                            .on("click", function() {
                                                slide6();
                                                d3.select("#button")
                                                    .on("click", function() {
                                                        d3.select("svg").remove();
                                                        interactiveChart();
                                                    });
                                            });
                                    });
                            });
                    });
            });
    }
    </script>
</head>

<body>
    <button id="button"></button>
    <img id="background" src="http://palm.desertsun.com/2016Projects/20160120TDSJailCalls/20160120TDSJailCallsWoman.svg">
    <img id="legend" src="http://palm.desertsun.com/2016Projects/20160120TDSJailCalls/legend.svg">
    <script>
    interactiveChart();
    </script>
</body>

</html>